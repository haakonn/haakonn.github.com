<!doctype html>
<html>
  <head>
    <link rel="stylesheet" href="style.css"></link>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">  </head>
  <body>
    <!-- Cloud animation from https://codepen.io/elchiconube/pen/naxOWv -->
    <div id="clouds">
      <div class="cloud x1"></div>
      <div class="cloud x2"></div>
      <div class="cloud x3"></div>
      <div class="cloud x4"></div>
      <div class="cloud x5"></div>

    </div>
    <div class="content">
      <table>
        <thead>
          <tr>
            <th>
              ğŸ•œ
            </th>
            <th>
              ğŸ”®
            </th>
          </tr>
        </thead>
        <tbody id="body">
        </tbody>
      </table>
    </div>
  </body>

  <script>
    const render = (data) => {
        const fmt = (hour, pre) => hour<10? `${pre}${hour}` : `${hour}`;
        const emoji = (name) => {
            let symbol;
            if (name.endsWith('_day')) symbol = name.substr(0, name.length-4);
            else if (name.endsWith('_night')) symbol = name.substr(0, name.length-6);
            else symbol = name;
            
            switch(symbol) {
            case 'clearsky': return 'â˜€ï¸';
            case 'cloudy': return 'â˜ï¸';
            case 'fair': return 'â›…';
            case 'fog': return 'ğŸŒ';
            case 'heavyrain': return 'ğŸŒ§ï¸';
            case 'heavyrainandthunder': return 'â›ˆï¸';
            case 'heavyrainshowers': return 'â˜”';
            case 'heavyrainshowersandthunder': return 'â›ˆï¸';
            case 'heavysleet': return 'â„ï¸ğŸŒ§ï¸';
            case 'heavysleetandthunder': return 'â„ï¸â›ˆï¸';
            case 'heavysleetshowers': return 'â„ï¸ğŸŒ§ï¸';
            case 'heavysleetshowersandthunder': return 'â„ï¸â›ˆï¸';
            case 'heavysnow': return 'â„ï¸â˜ƒï¸';
            case 'heavysnowandthunder': return 'â„ï¸â˜ƒï¸ğŸŒ©ï¸';
            case 'heavysnowshowers': return 'ğŸŒ¨ï¸â„ï¸â˜ƒï¸';
            case 'heavysnowshowersandthunder': return 'â„ï¸ğŸŒ¨ï¸â˜ƒï¸ğŸŒ©ï¸';
            case 'lightrain': return 'ğŸŒ¦ï¸';
            case 'lightrainandthunder': return 'ğŸŒ¦ï¸ğŸŒ©ï¸';
            case 'lightrainshowers': return 'ğŸŒ¦ï¸';
            case 'lightrainshowersandthunder': return 'ğŸŒ¦ï¸ğŸŒ©ï¸';
            case 'lightsleet': return 'â„ï¸ğŸŒ¦ï¸ğŸŒ©ï¸';
            case 'lightsleetandthunder': return 'â„ï¸ğŸŒ¦ï¸ğŸŒ©ï¸';
            case 'lightsleetshowers': return 'â„ï¸ğŸŒ¦ï¸';
            case 'lightsnow': return 'â„ï¸';
            case 'lightsnowandthunder': return 'â„ï¸ğŸŒ©ï¸';
            case 'lightsnowshowers': return 'â„ï¸';
            case 'lightssleetshowersandthunder': return 'â„ï¸ğŸŒ©ï¸';
            case 'lightssnowshowersandthunder': return 'â„ï¸ğŸŒ©ï¸';
            case 'partlycloudy': return 'â›…';
            case 'rain': return 'ğŸŒ§ï¸';
            case 'rainandthunder': return 'â›ˆï¸';
            case 'rainshowers': return 'â˜”';
            case 'rainshowersandthunder': return 'â›ˆï¸';
            case 'sleet': return 'â„ï¸ğŸŒ§ï¸';
            case 'sleetandthunder': return 'â„ï¸â›ˆï¸';
            case 'sleetshowers': return 'â„ï¸ğŸŒ§ï¸';
            case 'sleetshowersandthunder': return 'â„ï¸â›ˆï¸';
            case 'snow': return 'â„ï¸â˜ƒï¸';
            case 'snowandthunder': return 'â„ï¸ğŸŒ©ï¸';
            case 'snowshowers': return 'â„ï¸â˜ƒï¸';
            case 'snowshowersandthunder': return 'â„ï¸ğŸŒ©ï¸';
            default:
                console.log('Unknown', symbol);
                return 'â˜”';
            }
        }
        const rain = (amount) => amount!=0? `ğŸŒ§ï¸ ${amount}` : '';

        let body = document.getElementById("body");
        data.properties.timeseries.length=24;
        data.properties.timeseries.forEach((entry) => {
            let row = document.createElement("tr");
            let hour = row.appendChild(document.createElement("td"));
            const date = new Date(entry.time);
            hour.appendChild(
                document.createTextNode(`${fmt(date.getHours(), '0')}-${fmt((date.getHours()+1)%24, '0')}`));

            const temp = entry.data.instant.details.air_temperature;
            const symbol = entry.data.next_1_hours.summary.symbol_code;
            const precipitation = entry.data.next_1_hours.details.precipitation_amount;
            let details = row.appendChild(document.createElement("td"));
            details.appendChild(
                document.createTextNode(`${emoji(symbol)} ğŸŒ¡ï¸${fmt(+temp.toFixed(0), ' ')} ${rain(precipitation)}`));            
            details.classList.add('forecast', entry.data.next_12_hours.summary.symbol_confidence.replace(/\s/g, '_'))

            body.appendChild(row);

        });
    };

    fetch('weather.json').then(response => response.json()).then(data => render(data));
  </script>
</html>
